<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Monitoring Sungai IoT</title>

  <!-- MQTT.js (PALING STABIL DI GITHUB PAGES) -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      text-align: center;
      padding: 40px;
    }
    .card {
      background: white;
      padding: 30px;
      max-width: 400px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }
    .value {
      font-size: 32px;
      font-weight: bold;
      color: #007bff;
    }
    .status {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>Monitoring Ketinggian Sungai</h2>
    <div class="value"><span id="level">--</span> cm</div>
    <div id="status" class="status">Menghubungkan...</div>
  </div>

  <script>
    /* ===== KONFIGURASI MQTT ===== */
    const MQTT_URL = "wss://iot.midragondev.my.id:8083/mqtt";
    const MQTT_TOPIC = "sungai/ketinggian";

    const options = {
      username: "nexaryn",
      password: "31750321",
      keepalive: 60,
      reconnectPeriod: 2000,
      clean: true
    };

    /* ===== CONNECT ===== */
    const client = mqtt.connect(MQTT_URL, options);

    client.on("connect", () => {
      document.getElementById("status").innerHTML = "Terhubung ke server";
      client.subscribe(MQTT_TOPIC);
      console.log("MQTT Connected");
    });

    client.on("message", (topic, message) => {
      const level = parseFloat(message.toString());
      document.getElementById("level").innerHTML = level;

      let status = "Aman";
      if (level >= 40 && level < 70) status = "Siaga";
      else if (level >= 70) status = "Bahaya";

      document.getElementById("status").innerHTML = "Status: " + status;
    });

    client.on("error", err => {
      console.error("MQTT Error:", err);
      document.getElementById("status").innerHTML = "MQTT Error";
    });
  </script>
</body>
</html>


