<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Monitoring Sungai IoT</title>

  <!-- WAJIB: PAHO MQTT -->
  <script src="https://unpkg.com/paho-mqtt@1.1.0/paho-mqtt-min.js"></script>

  <!-- OPTIONAL: hilangkan error favicon -->
  <link rel="icon" href="data:,">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f5;
      text-align: center;
      padding-top: 50px;
    }
    .box {
      background: white;
      padding: 30px;
      max-width: 400px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .value {
      font-size: 40px;
      font-weight: bold;
    }
    .status {
      font-size: 22px;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<div class="box">
  <h2>Monitoring Ketinggian Air</h2>
  <div class="value" id="level">-- cm</div>
  <div class="status" id="status">Menghubungkan...</div>
</div>

<script>
/* ================== KONFIGURASI ================== */
const MQTT_HOST = "86d0fa0f82ae46da8385c68ee23959f5.s1.eu.hivemq.cloud";
const MQTT_PORT = 8884; // WSS
const MQTT_USER = "USERNAME_HIVEMQ";
const MQTT_PASS = "PASSWORD_HIVEMQ";
const TOPIC_LEVEL = "monitoring/air/level";

/* ================== CLIENT ================== */
const clientID = "web-" + Math.random().toString(16).substr(2, 8);
const client = new Paho.MQTT.Client(
  MQTT_HOST,
  MQTT_PORT,
  "/mqtt",
  clientID
);

client.onConnectionLost = function () {
  document.getElementById("status").innerHTML = "Koneksi terputus";
};

client.onMessageArrived = function (msg) {
  const level = parseFloat(msg.payloadString);
  document.getElementById("level").innerHTML = level + " cm";

  if (level < 40) {
    document.getElementById("status").innerHTML = "Status: AMAN";
    document.getElementById("status").style.color = "green";
  } else if (level < 70) {
    document.getElementById("status").innerHTML = "Status: SIAGA";
    document.getElementById("status").style.color = "orange";
  } else {
    document.getElementById("status").innerHTML = "Status: BAHAYA";
    document.getElementById("status").style.color = "red";
  }
};

client.connect({
  useSSL: true,
  userName: kandang,
  password: Firman1502,
  onSuccess: function () {
    document.getElementById("status").innerHTML = "Terhubung ke MQTT";
    client.subscribe(TOPIC_LEVEL);
  },
  onFailure: function (err) {
    document.getElementById("status").innerHTML = "Gagal koneksi";
    console.log(err.errorMessage);
  }
});
</script>

</body>
</html>

