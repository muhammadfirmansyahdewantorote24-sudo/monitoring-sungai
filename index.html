<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HydroWatch - River Monitoring</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- âœ… PAHO MQTT (WAJIB DEFER) -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/mqttws31.min.js"></script>

<style>
body { font-family: 'Outfit', sans-serif; }
.glass-panel {
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255,255,255,0.1);
}
.wave {
  background-size: 50% 100%;
  animation: wave 4s linear infinite;
}
@keyframes wave {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}
</style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">

<div class="container mx-auto px-4 py-8 max-w-4xl" id="dashboard">

<header class="flex justify-between items-center mb-8 glass-panel p-4 rounded-2xl">
  <div class="flex items-center gap-3">
    <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center">
      <i class="fa-solid fa-water"></i>
    </div>
    <div>
      <h1 class="text-xl font-bold">HydroWatch</h1>
      <p class="text-xs text-gray-400">River Monitoring System</p>
    </div>
  </div>

  <div id="status-indicator" class="flex items-center gap-2 px-3 py-1 rounded-full bg-red-500/20 text-red-400 text-xs">
    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
    <span id="status-text">Disconnected</span>
  </div>
</header>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

<div class="glass-panel p-6 rounded-3xl flex flex-col items-center">
<h2 class="mb-4 font-semibold">Water Level</h2>

<div class="relative w-48 h-64 border border-white/20 rounded-b-3xl overflow-hidden bg-gray-800">
  <div id="water-fill" class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-blue-600 to-cyan-400 transition-all duration-1000" style="height:0%">
    <div class="wave absolute top-[-10px] left-0 w-[200%] h-[20px] bg-cyan-400 opacity-70"></div>
  </div>
  <div class="absolute inset-0 flex items-center justify-center">
    <span id="water-percentage" class="text-4xl font-bold">0%</span>
  </div>
</div>

<div class="grid grid-cols-2 gap-4 mt-6 w-full">
  <div class="bg-white/5 p-3 rounded-xl text-center">
    <p class="text-xs text-gray-400">Depth</p>
    <p class="text-xl font-bold"><span id="water-cm">0</span> cm</p>
  </div>
  <div class="bg-white/5 p-3 rounded-xl text-center">
    <p class="text-xs text-gray-400">Status</p>
    <p id="alert-status" class="font-bold text-emerald-400">SAFE</p>
  </div>
</div>
</div>

<div class="glass-panel p-6 rounded-3xl">
<h2 class="mb-4 font-semibold">System Log</h2>
<div id="system-log" class="text-xs text-gray-400 h-48 overflow-y-auto space-y-1">
<div>> System initialized...</div>
</div>
</div>

</div>
</div>

<script>
/* ================= RUN AFTER LOAD ================= */
window.onload = function () {

/* MQTT CONFIG */
const MQTT_HOST = "86d0fa0f82ae46da8385c68ee23959f5.s1.eu.hivemq.cloud";
const MQTT_PORT = 8884;
const MQTT_USER = "kandang";
const MQTT_PASS = "Firman1502";
const MQTT_TOPIC = "monitoring/air/level";
const CLIENT_ID = "Web_" + Math.random().toString(16).substr(2,8);
const MAX_DEPTH = 200;

/* INIT CLIENT */
const client = new Paho.MQTT.Client(MQTT_HOST, MQTT_PORT, CLIENT_ID);

client.onConnectionLost = () => log("Connection lost");

client.onMessageArrived = msg => {
  const dist = parseFloat(msg.payloadString);
  const water = Math.max(0, MAX_DEPTH - dist);
  const pct = Math.min(100, Math.round((water / MAX_DEPTH) * 100));

  document.getElementById("water-cm").innerText = dist;
  document.getElementById("water-percentage").innerText = pct + "%";
  document.getElementById("water-fill").style.height = pct + "%";

  const status = document.getElementById("alert-status");
  status.textContent = pct > 80 ? "DANGER" : pct > 60 ? "WARNING" : "SAFE";
};

/* CONNECT */
client.connect({
  useSSL: true,
  userName: kandang,
  password: Firman1502,
  onSuccess: () => {
    document.getElementById("status-text").innerText = "Live";
    client.subscribe(MQTT_TOPIC);
    log("MQTT Connected");
  },
  onFailure: () => log("MQTT Failed")
});

/* LOG */
function log(t){
  const d=document.createElement("div");
  d.textContent="> "+t;
  document.getElementById("system-log").appendChild(d);
}

};
</script>

</body>
</html>

