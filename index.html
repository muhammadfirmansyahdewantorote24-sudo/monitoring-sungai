<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>River Monitoring Dashboard</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- PAHO MQTT (WAJIB INI, JANGAN GANTI) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>

<style>
/* ==== CSS ASLI LU ==== */
body { font-family: 'Outfit', sans-serif; }

/* Glass */
.glass-panel{
background:rgba(255,255,255,.05);
backdrop-filter:blur(16px);
border:1px solid rgba(255,255,255,.1)
}

/* Animations */
@keyframes blob{
0%{transform:translate(0,0) scale(1)}
33%{transform:translate(30px,-50px) scale(1.1)}
66%{transform:translate(-20px,20px) scale(.9)}
100%{transform:translate(0,0) scale(1)}
}
.animate-blob{animation:blob 7s infinite}
.animation-delay-2000{animation-delay:2s}
.animation-delay-4000{animation-delay:4s}

@keyframes wave{
0%{transform:translateX(0)}
50%{transform:translateX(-25%)}
100%{transform:translateX(-50%)}
}
.wave{
background:url("data:image/svg+xml;utf8,<svg viewBox='0 0 1200 120' xmlns='http://www.w3.org/2000/svg'><path d='M321.39 56.44c58-10.79 114.16-30.13 172-41.86 82.39-16.72 168.19-17.73 250.45-.39C823.78 31 906.67 72 985.66 92.83c70.05 18.48 146.53 26.09 214.34 3V0H0v27.35a600.21 600.21 0 00321.39 29.09z' fill='white'/></svg>");
background-size:50% 100%;
animation:wave 4s linear infinite
}
</style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center overflow-hidden">

<!-- ===== HTML ASLI LU (DIPERSINGKAT DEMI JAWABAN, TAPI STRUKTUR SAMA) ===== -->
<div id="dashboard" class="container mx-auto max-w-4xl hidden">
<h1 class="text-2xl font-bold mb-4">HydroWatch</h1>

<div class="relative w-48 h-64 border rounded overflow-hidden mx-auto">
<div id="water-fill" class="absolute bottom-0 w-full bg-cyan-500" style="height:0%"></div>
<div class="absolute inset-0 flex items-center justify-center">
<span id="water-percentage" class="text-3xl font-bold">0%</span>
</div>
</div>

<p class="mt-4 text-center">
Depth: <span id="water-cm">0</span> cm
</p>
<p class="text-center">
Status: <span id="alert-status">SAFE</span>
</p>
</div>

<script>
/* ==== JS ASLI LU (DIFIX) ==== */
let client;
const MAX_DEPTH_CM = 200;

function connectMQTT(){
client = new Paho.MQTT.Client(
"iot.midragondev.my.id",
8083,
"web_"+Math.random().toString(16).substr(2,8)
);

client.onMessageArrived = onMessageArrived;
client.connect({
useSSL:false,
onSuccess:()=>{
document.getElementById("dashboard").classList.remove("hidden");
client.subscribe("iot/waterlevel/data");
}
});
}

function onMessageArrived(msg){
const data = JSON.parse(msg.payloadString);
const distance = data.water_level;
const height = Math.max(0, MAX_DEPTH_CM - distance);
const percent = Math.min(100, (height/MAX_DEPTH_CM)*100);

document.getElementById("water-cm").innerText = distance;
document.getElementById("water-percentage").innerText = Math.round(percent)+"%";
document.getElementById("water-fill").style.height = percent+"%";

document.getElementById("alert-status").innerText =
percent>80?"CRITICAL":percent>60?"WARNING":"SAFE";
}

connectMQTT();
</script>

</body>
</html>

